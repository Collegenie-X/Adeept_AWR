# 🤖 라즈베리파이 자율주행 로봇 제품 요구사항 문서

## 📋 프로젝트 개요

### 🎯 프로젝트 목표
라즈베리파이를 기반으로 한 지능형 자율주행 로봇 개발
- **라인 추적**: 3개 적외선 센서를 이용한 정확한 라인 추적
- **장애물 회피**: 초음파 센서를 이용한 안전한 장애물 회피
- **상태 표시**: LED를 통한 직관적인 로봇 상태 표시
- **모듈형 설계**: 유지보수가 용이한 컴포넌트 기반 아키텍처

### 📊 기술 스펙
- **플랫폼**: 라즈베리파이 4B+ (Python 3.7+)
- **모터**: 4개 기어모터 (L298N 드라이버)
- **센서**: 라인센서 3개, 초음파센서 1개
- **액추에이터**: WS2812 LED스트립, 부저
- **통신**: GPIO, I2C, PWM

---

## 🔧 시스템 요구사항

### 📋 기능적 요구사항 (Functional Requirements)

#### FR-001: 라인 추적 기능
- **설명**: 바닥의 라인을 감지하여 자동으로 따라가는 기능
- **입력**: 3개 적외선 라인 센서 (좌측, 중앙, 우측)
- **출력**: 모터 제어 명령 (직진, 좌회전, 우회전)
- **성능**: 최대 속도 80% 기준 라인 이탈률 5% 이하
- **우선순위**: 높음

#### FR-002: 장애물 회피 기능
- **설명**: 전방 장애물을 감지하여 안전하게 회피하는 기능
- **입력**: HC-SR04 초음파 센서
- **출력**: 회피 동작 (정지, 후진, 우회전)
- **성능**: 10cm 이하에서 즉시 정지, 20cm 이하에서 회피 동작
- **우선순위**: 최고 (안전 관련)

#### FR-003: 상태 표시 기능
- **설명**: 로봇의 현재 상태를 시각적으로 표시하는 기능
- **입력**: 로봇 내부 상태 정보
- **출력**: LED 색상 및 패턴, 부저 소리
- **성능**: 상태 변경 시 100ms 이내 표시 업데이트
- **우선순위**: 보통

#### FR-004: 통합 제어 기능
- **설명**: 센서 데이터를 융합하여 최적의 주행 결정을 내리는 기능
- **입력**: 모든 센서 데이터
- **출력**: 통합 제어 명령
- **성능**: 100ms 제어 주기 유지
- **우선순위**: 높음

### 🏗️ 비기능적 요구사항 (Non-Functional Requirements)

#### NFR-001: 성능 요구사항
- **응답 시간**: 센서 입력 → 모터 출력 100ms 이내
- **처리량**: 초당 10회 이상 제어 루프 실행
- **CPU 사용률**: 평균 70% 이하 유지
- **메모리 사용량**: 256MB 이하

#### NFR-002: 안정성 요구사항
- **가용성**: 연속 운행 시간 30분 이상
- **복구성**: 오류 발생 시 5초 이내 안전 모드 전환
- **내결함성**: 센서 1개 오류 시에도 기본 동작 유지

#### NFR-003: 사용성 요구사항
- **설치 용이성**: pip 설치 후 바로 실행 가능
- **운영 편의성**: 단순한 키보드 명령어 인터페이스
- **디버깅**: 상세한 로그 및 상태 정보 제공

#### NFR-004: 유지보수성 요구사항
- **모듈성**: 기능별 독립 모듈 구조
- **확장성**: 새로운 센서/액추에이터 쉽게 추가 가능
- **코드 가독성**: 30글자 이내 명확한 함수/클래스명
- **문서화**: 모든 함수에 한글 주석 포함

---

## 🏛️ 시스템 아키텍처

### 📦 모듈 구조
```
autonomous_robot/
├── controllers/          # 제어 로직 모듈
│   ├── autonomous_controller.py  # 메인 자율주행 컨트롤러
│   └── __init__.py
├── actuators/           # 액추에이터 모듈
│   ├── motor_controller.py      # 모터 제어
│   ├── led_controller.py        # LED 제어
│   └── __init__.py
├── sensors/             # 센서 모듈
│   ├── line_sensor.py           # 라인 센서
│   ├── ultrasonic_sensor.py     # 초음파 센서
│   └── __init__.py
├── utils/               # 유틸리티 모듈 (확장용)
├── config/              # 설정 파일 (확장용)
└── __init__.py
```

### 🔄 데이터 흐름
```
[센서 계층]
라인센서 → 라인 위치 데이터
초음파센서 → 거리 데이터
    ↓
[제어 계층]
센서 융합 → 의사결정 → 명령 생성
    ↓
[액추에이터 계층]
모터 제어 → 이동
LED 제어 → 상태 표시
```

### ⚡ 제어 루프
```python
while 자율주행_활성:
    # 1. 센서 데이터 수집 (10ms)
    라인_데이터 = 라인센서.읽기()
    거리_데이터 = 초음파센서.읽기()
    
    # 2. 데이터 융합 및 의사결정 (20ms)
    if 거리_데이터 < 긴급_거리:
        명령 = 비상정지()
    elif 거리_데이터 < 회피_거리:
        명령 = 장애물회피()
    else:
        명령 = 라인추적(라인_데이터)
    
    # 3. 액추에이터 제어 (30ms)
    모터.실행(명령)
    LED.상태표시(명령.상태)
    
    # 4. 주기 대기 (40ms)
    time.sleep(0.06)  # 총 100ms 주기
```

---

## 🔌 하드웨어 인터페이스

### 📍 GPIO 핀 할당
| 기능 | GPIO | 물리핀 | 타입 | 전압 |
|------|------|--------|------|------|
| 모터A Enable | 4 | 7 | PWM 출력 | 3.3V |
| 모터A Pin1 | 14 | 8 | 디지털 출력 | 3.3V |
| 모터A Pin2 | 15 | 10 | 디지털 출력 | 3.3V |
| 모터B Enable | 17 | 11 | PWM 출력 | 3.3V |
| 모터B Pin1 | 27 | 13 | 디지털 출력 | 3.3V |
| 모터B Pin2 | 18 | 12 | 디지털 출력 | 3.3V |
| LED 스트립 | 18 | 12 | PWM 출력 | 3.3V |
| 초음파 Trig | 23 | 16 | 디지털 출력 | 3.3V |
| 초음파 Echo | 24 | 18 | 디지털 입력 | 3.3V |
| 라인센서 L | 19 | 35 | 디지털 입력 | 3.3V |
| 라인센서 C | 16 | 36 | 디지털 입력 | 3.3V |
| 라인센서 R | 19 | 35 | 디지털 입력 | 3.3V |
| 부저 | 20 | 38 | 디지털 출력 | 3.3V |

### 🔋 전원 요구사항
- **라즈베리파이**: 5V 3A (USB-C)
- **모터**: 12V 2A (외부 배터리)
- **센서/LED**: 3.3V/5V (라즈베리파이 공급)
- **총 소비전력**: 약 40W (최대 부하 시)

---

## 💻 소프트웨어 요구사항

### 🐍 개발 환경
- **Python**: 3.7 이상
- **OS**: Raspberry Pi OS (32-bit/64-bit)
- **메모리**: 최소 1GB RAM
- **저장공간**: 최소 200MB

### 📚 의존성 라이브러리
```python
# 필수 라이브러리
RPi.GPIO >= 0.7.0          # GPIO 제어
rpi_ws281x >= 4.3.0        # WS2812 LED 제어
adafruit-circuitpython-pca9685 >= 3.4.0  # 서보 제어 (선택)

# 시스템 라이브러리
time, threading, signal    # 내장 모듈
enum, dataclasses, typing  # 타입 힌트
```

### 🛠️ 설치 요구사항
```bash
# 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# Python 패키지 설치
sudo pip3 install RPi.GPIO rpi_ws281x

# GPIO 권한 설정
sudo usermod -a -G gpio $USER

# I2C 활성화 (서보 모터용)
sudo raspi-config
# → Interface Options → I2C → Enable
```

---

## 🧪 테스트 요구사항

### 🔍 단위 테스트 (Unit Tests)
- **MotorController**: 개별 모터 동작 확인
- **LineSensor**: 센서 읽기 및 필터링 테스트
- **UltrasonicSensor**: 거리 측정 정확도 테스트
- **LEDController**: LED 색상 및 패턴 테스트

### 🔗 통합 테스트 (Integration Tests)
- **센서-모터 연동**: 센서 입력에 따른 모터 출력 확인
- **장애물 회피**: 실제 장애물 배치 후 회피 동작 확인
- **라인 추적**: 다양한 라인 형태에서 추적 성능 확인

### 🎭 시나리오 테스트 (Scenario Tests)
- **정상 주행**: 직선 라인에서 안정적 추적
- **곡선 주행**: S자 곡선에서 라인 추적
- **장애물 회피**: 라인 상 장애물 회피 후 라인 복귀
- **비상 상황**: 센서 오류 시 안전 모드 진입

### 📊 성능 테스트 (Performance Tests)
- **응답 시간**: 센서 → 액추에이터 지연 시간 측정
- **처리량**: 초당 제어 루프 실행 횟수 측정
- **리소스 사용**: CPU, 메모리 사용량 모니터링
- **배터리 수명**: 연속 운행 시간 측정

---

## 🔄 개발 프로세스

### 📅 개발 단계
1. **요구사항 분석** ✅ (완료)
2. **시스템 설계** ✅ (완료)
3. **모듈 개발** ✅ (완료)
4. **단위 테스트** 🔄 (진행 중)
5. **통합 테스트** ⏳ (예정)
6. **최적화** ⏳ (예정)
7. **문서화** ✅ (완료)

### 🏗️ 구현 원칙
- **모듈형 설계**: 기능별 독립적 모듈 구현
- **클린 코드**: 가독성 높은 코드 작성
- **Early Return**: 조건문에서 빠른 반환 패턴 사용
- **한글 주석**: 모든 함수와 클래스에 한글 설명 추가
- **타입 힌트**: 함수 매개변수와 반환값에 타입 명시

### 📝 코딩 컨벤션
```python
# 파일명: snake_case.py
# 클래스명: PascalCase
# 함수명: snake_case (30글자 이내)
# 변수명: snake_case
# 상수명: UPPER_SNAKE_CASE

class MotorController:  # 모터제어기 (구체적이고 명확한 이름)
    def move_forward_with_speed(self, speed: int) -> None:
        """지정된 속도로 전진하는 함수"""
        # Early return 패턴 사용
        if not self.is_initialized:
            return
        
        if speed < 0 or speed > 100:
            return
        
        # 메인 로직 구현
        self._execute_forward_motion(speed)
```

---

## 🚀 배포 및 운영

### 📦 배포 요구사항
- **설치 스크립트**: 자동 환경 설정 스크립트 제공
- **설정 파일**: 하드웨어별 맞춤 설정 지원
- **문서**: 설치/운영 가이드 제공
- **백업**: 설정 및 로그 백업 기능

### 🔍 모니터링 요구사항
- **성능 모니터링**: CPU, 메모리, 네트워크 사용량
- **오류 로깅**: 상세한 오류 로그 및 스택 트레이스
- **상태 체크**: 주요 컴포넌트 동작 상태 확인
- **원격 진단**: SSH를 통한 원격 문제 해결

### 🔒 보안 요구사항
- **접근 제어**: GPIO 접근 권한 관리
- **안전 모드**: 비정상 상황 시 안전한 정지
- **데이터 보호**: 센서 데이터 무결성 보장

---

## 📈 향후 개선 계획

### 🔮 Phase 2 기능 (v2.0)
- **카메라 비전**: OpenCV를 이용한 컴퓨터 비전 기능
- **음성 제어**: 음성 명령을 통한 로봇 제어
- **무선 제어**: WiFi/Bluetooth를 통한 원격 제어
- **학습 기능**: 주행 패턴 학습 및 최적화

### 🔧 Phase 3 기능 (v3.0)
- **다중 로봇**: 여러 로봇 간 협업 기능
- **맵핑**: SLAM을 이용한 지도 작성
- **자율 충전**: 자동 충전 스테이션 복귀
- **IoT 연동**: 클라우드 기반 모니터링

### 🛠️ 기술적 개선사항
- **성능 최적화**: C++ 확장 모듈 사용
- **실시간 처리**: RT-Kernel 적용
- **전력 효율**: 저전력 모드 구현
- **센서 융합**: 칼만 필터 적용

---

## 📋 변경 이력

### v1.0.0 (2024-현재)
- ✅ **기본 아키텍처 구현**: 모듈형 설계 완성
- ✅ **모터 제어**: L298N을 이용한 4모터 제어
- ✅ **라인 추적**: 3센서 기반 라인 추적 로직
- ✅ **장애물 회피**: 초음파 센서 기반 회피 시스템
- ✅ **LED 상태 표시**: WS2812 기반 시각적 피드백
- ✅ **통합 제어**: 센서 융합 기반 자율주행
- ✅ **안전 기능**: 비상 정지 및 예외 처리
- ✅ **문서화**: 완전한 API 문서 및 사용 가이드

### 주요 개선사항
- **모듈화**: 기존 단일 파일에서 기능별 모듈 분리
- **객체지향**: 클래스 기반 설계로 재사용성 향상
- **에러 처리**: 강건한 예외 처리 및 복구 메커니즘
- **성능**: 100ms 제어 주기로 반응성 개선
- **사용성**: 직관적인 CLI 인터페이스 제공

---

## 📞 지원 및 연락처

### 🛠️ 기술 지원
- **하드웨어 문제**: pinout.md 참조 및 연결 확인
- **소프트웨어 문제**: 로그 파일 확인 및 디버그 모드 실행
- **성능 문제**: 시스템 리소스 모니터링

### 📚 참고 자료
- **하드웨어 매뉴얼**: `pinout.md`
- **API 문서**: 각 모듈 docstring 참조
- **예제 코드**: `main.py` 및 각 모듈 `__main__` 블록
- **회로도**: `Circuit-Schematic-Adeept_MotorHAT.pdf`

### 🤝 기여 방법
1. 이슈 등록: 버그 리포트 또는 기능 요청
2. 포크 및 브랜치: feature/버그명 또는 feature/기능명
3. 테스트: 변경사항에 대한 충분한 테스트
4. 풀 리퀘스트: 상세한 변경 내용 설명

---

**📝 문서 버전**: v1.0.0  
**🔄 최종 업데이트**: 2024년 모듈형 자율주행 로봇 완성 시점  
**👥 작성자**: 라즈베리파이 자율주행 프로젝트 팀  
**📧 문의**: 프로젝트 관련 기술 지원 및 개선 제안
